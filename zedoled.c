/*
 * Copyright (c) 2009 Xilinx, Inc.  All rights reserved.
 *
 * Xilinx, Inc.
 * XILINX IS PROVIDING THIS DESIGN, CODE, OR INFORMATION "AS IS" AS A
 * COURTESY TO YOU.  BY PROVIDING THIS DESIGN, CODE, OR INFORMATION AS
 * ONE POSSIBLE   IMPLEMENTATION OF THIS FEATURE, APPLICATION OR
 * STANDARD, XILINX IS MAKING NO REPRESENTATION THAT THIS IMPLEMENTATION
 * IS FREE FROM ANY CLAIMS OF INFRINGEMENT, AND YOU ARE RESPONSIBLE
 * FOR OBTAINING ANY RIGHTS YOU MAY REQUIRE FOR YOUR IMPLEMENTATION.
 * XILINX EXPRESSLY DISCLAIMS ANY WARRANTY WHATSOEVER WITH RESPECT TO
 * THE ADEQUACY OF THE IMPLEMENTATION, INCLUDING BUT NOT LIMITED TO
 * ANY WARRANTIES OR REPRESENTATIONS THAT THIS IMPLEMENTATION IS FREE
 * FROM CLAIMS OF INFRINGEMENT, IMPLIED WARRANTIES OF MERCHANTABILITY
 * AND FITNESS FOR A PARTICULAR PURPOSE.
 *
 */

/*
 * helloworld.c: simple test application
 */

#include <stdio.h>
#include "platform.h"
#include "sleep.h"

void print(char *str);

#define OLED_CTRL 		0x79C00000
#define OLED_DATA 		0x79C00004
#define OLED_STATUS 	0x79C00008

#define OLED_CTRL_DC	(0x1 << 0)
#define OLED_CTRL_RES	(0x1 << 1)
#define OLED_CTRL_VBAT	(0x1 << 2)
#define OLED_CTRL_VDD	(0x1 << 3)

#define READ32( _register_, _value_ ) \
        ((_value_) = *((volatile int *)(_register_)))

#define WRITE32( _register_, _value_ ) \
        (*((volatile int *)(_register_)) = (_value_))


const unsigned char Zedboard_logo_b [] = {
0x00, 0x00, 0x00, 0x00, 0x70, 0xF8, 0xFC, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFC, 0xF8, 0xF0,
0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x80, 0xC0, 0xE0, 0xE0, 0xF1, 0xF1, 0xF3, 0xF3, 0xF3, 0xF3, 0xE1, 0xF1, 0xF1, 0xF0, 0xF8,
0xF9, 0x79, 0x7D, 0x7F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F,
0x1F, 0x0F, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x83, 0xE3, 0x73, 0x3B, 0x1F,
0x07, 0x03, 0x00, 0x00, 0x80, 0xC0, 0x60, 0x60, 0x20, 0x60, 0xC0, 0xC0, 0x00, 0x00, 0x80, 0xC0,
0x60, 0x60, 0x60, 0x61, 0xE3, 0xFF, 0xFF, 0x00, 0x00, 0x03, 0xFF, 0xFF, 0x63, 0x63, 0x63, 0x63,
0x73, 0xFE, 0xDE, 0x80, 0x00, 0x00, 0xC0, 0xC0, 0x60, 0x60, 0x60, 0x60, 0xC0, 0xC0, 0x00, 0x00,
0x80, 0xC0, 0x60, 0x60, 0x60, 0x60, 0xE0, 0xE0, 0xE0, 0x00, 0x00, 0x60, 0xE0, 0xE0, 0xC0, 0xC0,
0xC0, 0x60, 0x60, 0x00, 0xC0, 0xC0, 0x60, 0x60, 0x60, 0xE3, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
0x00, 0x0F, 0x1F, 0x3F, 0x3F, 0x7F, 0x7F, 0x7F, 0x3F, 0x3F, 0x3F, 0x1F, 0x1F, 0x1F, 0x3F, 0x3C,
0x3C, 0x7C, 0x7C, 0xF8, 0xF8, 0xF8, 0xF8, 0xFC, 0xFC, 0xFC, 0xFC, 0xFE, 0xFE, 0xFE, 0xFC, 0xFC,
0xFC, 0xF8, 0xF0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x18, 0x1E, 0x1F, 0x1F, 0x19, 0x18, 0x18, 0x18,
0x1C, 0x1C, 0x00, 0x00, 0x07, 0x0F, 0x1B, 0x1B, 0x1B, 0x1B, 0x0B, 0x0F, 0x00, 0x00, 0x07, 0x0F,
0x18, 0x18, 0x18, 0x18, 0x1C, 0x1F, 0x1F, 0x00, 0x00, 0x00, 0x1F, 0x1F, 0x1C, 0x18, 0x18, 0x18,
0x18, 0x1C, 0x0F, 0x07, 0x00, 0x03, 0x0F, 0x0C, 0x18, 0x18, 0x18, 0x18, 0x0F, 0x07, 0x00, 0x00,
0x0F, 0x0F, 0x18, 0x18, 0x18, 0x18, 0x1F, 0x1F, 0x1F, 0x18, 0x00, 0x00, 0x18, 0x1F, 0x03, 0x01,
0x00, 0x00, 0x00, 0x07, 0x0F, 0x1C, 0x18, 0x18, 0x18, 0x18, 0x1F, 0x1F, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x0F, 0x1F, 0x1F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x1F,
0x1F, 0x0F, 0x07, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

int main()
{
	int i = 0;
	volatile int oledctrl = OLED_CTRL_RES | OLED_CTRL_VBAT | OLED_CTRL_VDD;
	volatile int status = 0;

    init_platform();
    print("Hello Oled World\n\r");

    READ32(OLED_STATUS, status);
    if(status & 0x01)
    	print("Fifo Empty\n\r");
    else if(status & 0x02)
    	print("Fifo full...?\n\r");
    else
    	print("Fifo not empty... problem\n\r");

    // Oled initialization
    print("Init...");

    // VDD on
    oledctrl = OLED_CTRL_RES | OLED_CTRL_VBAT;
    WRITE32(OLED_CTRL, oledctrl);
    usleep(1000);
    // Display off
    WRITE32(OLED_DATA, 0xAE);

    // Reset on
    oledctrl = OLED_CTRL_VBAT;
    WRITE32(OLED_CTRL, oledctrl);
    usleep(1000);
    // off
    oledctrl = OLED_CTRL_RES | OLED_CTRL_VBAT;
    WRITE32(OLED_CTRL, oledctrl);
    usleep(1000);

    // Charge pump
    WRITE32(OLED_DATA, 0x8D);
    WRITE32(OLED_DATA, 0x14);
    WRITE32(OLED_DATA, 0xD9);
    WRITE32(OLED_DATA, 0xF1);

    // VBAT on
    oledctrl = OLED_CTRL_RES;
    WRITE32(OLED_CTRL, oledctrl);
    usleep(100000);

    // Display contrast
    WRITE32(OLED_DATA, 0x81);
    WRITE32(OLED_DATA, 0x0F);

    // Display config
	WRITE32(OLED_DATA, 0xd3);
	WRITE32(OLED_DATA, 0x20);

	WRITE32(OLED_DATA, 0xda);
	WRITE32(OLED_DATA, 0x22);

	WRITE32(OLED_DATA, 0x20);
	WRITE32(OLED_DATA, 0x00);

	WRITE32(OLED_DATA, 0x21);
	WRITE32(OLED_DATA, 0x00);
	WRITE32(OLED_DATA, 0x7f);

	WRITE32(OLED_DATA, 0x22);
	WRITE32(OLED_DATA, 0x00);
	WRITE32(OLED_DATA, 0x07);

    // Display on
    WRITE32(OLED_DATA, 0xAF);

    // Fill full screen
    //WRITE32(OLED_DATA, 0xA5);

    // Wait for empty fifo
    do {
    	READ32(OLED_STATUS, status);
    	print(".");
    }
    while(!(status & 0x1));
    print("Done\n\r");


    //Oled write data to print
    print("Data");
    // Use Data signal
    oledctrl = OLED_CTRL_RES | OLED_CTRL_DC;
    WRITE32(OLED_CTRL, oledctrl);
	usleep(100);

    for(i = 0; i < 128*8; i++) {
    	WRITE32(OLED_DATA, Zedboard_logo_b[i]);
		do {
			READ32(OLED_STATUS, status);
		}
		while(!(status & 0x1));
    }


    // Set vertical + horizontal scrolling
    // Use Command signal
    oledctrl = OLED_CTRL_RES;
    WRITE32(OLED_CTRL, oledctrl);
	usleep(100);
	WRITE32(OLED_DATA, 0x29);
	WRITE32(OLED_DATA, 0x00);
	WRITE32(OLED_DATA, 0x00);
	WRITE32(OLED_DATA, 0x00);
	WRITE32(OLED_DATA, 0x07);
	WRITE32(OLED_DATA, 0x01);
	WRITE32(OLED_DATA, 0x2F);




    while(1);

    return 0;
}
